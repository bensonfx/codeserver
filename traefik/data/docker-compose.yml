version: '3'
services:
  traefik:
    container_name: traefik-v2
    image: traefik:v2.1
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider localhost:8082/ping || exit 1"]
    environment:
      TZ: "Asia/Shanghai"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      # - ./data/traefik.toml:/etc/traefik/traefik.toml
      # - ./data/dynamic_conf.toml:/etc/traefik/dynamic_conf.toml
      - ./data/traefik.yml:/etc/traefik/traefik.yml
      - ./data/dynamic_conf.yml:/etc/traefik/dynamic_conf.yml
      - ./data/ssl:/data/ssl
      - ./logs:/logs
    ports:
      - "5080:80"
      - "5443:443"
    labels:
      - "traefik.docker.network=traefik"
      - "traefik.http.routers.traefik.service=api@internal"
    networks:
      - "traefik"
  # ldap:
  #   image: osixia/openldap
  #   domainname: "ldap.bensonfx.net"
  #   hostname: "ldap.bensonfx.net"
  #   ports:
  #     - "389:389"
  #     - "636:636"
  #   restart: unless-stopped
  #   environment:
  #     TZ: "Asia/Shanghai"
  #     LDAP_ORGANISATION: "bensonfx.net"
  #     LDAP_DOMAIN: "bensonfx.net"
  #     LDAP_ADMIN_PASSWORD: "oUT5DngfuLqr9KRwVh1w+e"
  #     LDAP_CONFIG_PASSWORD: "eHNntGgELAFWzqavH/1ii6"
  #     LDAP_TLS_CRT_FILENAME: "bensonfx.net.crt"
  #     LDAP_TLS_KEY_FILENAME: "bensonfx.net.key"
  #     LDAP_TLS_CA_CRT_FILENAME: "alpha_ca.crt"
  #     LDAP_TLS_VERIFY_CLIENT: "never"
  #   volumes:
  #     - ./data/ldap/database:/var/lib/ldap
  #     - ./data/ldap/config:/etc/ldap/slapd.d
  #     - ./data/ssl:/container/service/slapd/assets/certs
  # lam:
  #   image: bensonfx/lam
  #   volumes:
  #     - "./data/lam:/wwwroot/lam"
  #   working_dir: /wwwroot
  # web:
  #   image: bensonfx/caddy:0.11.1
  #   restart: always
  #   environment:
  #     CADDY_SERVER: http://ldap.bensonfx.net
  #     CADDY_ROOT: /wwwroot/lam
  #     FASTCGI_PATH: lam:9000
  #   volumes:
  #     - "./data/lam:/wwwroot/lam"
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.port=80"
  #     #- "traefik.protocol=http"
  #     - "traefik.frontend.passHostHeader=true"
  #     - "traefik.frontend.headers.contentTypeNosniff=true"
  #     - "traefik.frontend.headers.browserXSSFilter=true"
  #     - "traefik.frontend.rule=Host:ldap.bensonfx.net"
  #     - "traefik.docker.network=traefik"
  #   ports:
  #     - "8080:80"
  #   networks:
  #     - "traefik"
  #     - "default"
networks:
  traefik:
    external: true

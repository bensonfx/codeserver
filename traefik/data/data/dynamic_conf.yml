tls:
  certificates:
  - certFile: /data/ssl/bensonfx.net.crt
    keyFile: /data/ssl/bensonfx.net.key

http:
  middlewares:
    basic-auth:
      basicAuth:
        users:
        - "benson:$apr1$T7iXkMR7$UhhrVkDs7R8oVwCUgHrfN0"
    https-redirect:
      redirectScheme:
        scheme: https
        permanent: false
        port: 5443
    my-headers:
      Headers:
        contentTypeNosniff: true
        browserXSSFilter: true
        sslRedirect: true
    gzip:
      compress: {}
    admin-stripprefix:
      stripPrefix:
        prefixes:
        - "/admin"

  services:
    dummy:
      loadBalancer:
        servers:
          - url = "" # or url: "localhost"
    dsphoto:
      loadBalancer:
        servers:
        - url: "http://nas.bensonfx.net"
    nas:
      loadBalancer:
        servers:
        - url: "http://nas.bensonfx.net:5000"

  routers:
    # tricks
    # https://github.com/containous/traefik/issues/4863#issuecomment-491093096
      https-redirect:
      rule: "HostRegexp(`{any:.*}`)"
      service: dummy@file
    dashboard:
      entryPoints:
        - http
        - https
      service: api@internal
      middlewares: ["basic-auth", "https-redirect"]
      rule: "Host(`admin.bensonfx.net`)"
      tls: {}
    dsphoto:
      entryPoints:
        - http
        - https
      service: dsphoto@file
      rule: "Host(`photo.bensonfx.net`)"
      tls: {}
    nas:
      entryPoints:
        - http
        - https
      service: nas@file
      rule: "Host(`nas.bensonfx.net`)"
      tls: {}
